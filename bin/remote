#!/bin/bash


curr_dir="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
. $curr_dir/remote.config

while getopts :i opt; do
	case $opt in
		i) REMOTE_OPT_SSH_KEY=${@:${$OPTIND}}; echo REMOTE_OPT_SSH_KEY;;
		\?) echo "Invalid option: -$OPTARG"; echo "Usage remote [-i]  <user@hostname> <module>";;
	esac
done



if [ $# -lt 2 ]; then
	echo "Usage remote [-i] <user@hostname> <module>"
else	
	REMOTE_IN_MODULE=${@:${#@}}
	REMOTE_IN_SSH_CREDENTIALS=${@:${#@-1}}
	if [ ! -e $curr_dir/$module/go ]; then
		echo "Uknown pkg module '$module'."
	else
		scp -r $curr_dir/../pkg/$module $REMOTE_USER@$REMOTE_HOST:/home/$REMOTE_USER/.	
		ssh -i $SSH_KEY $REMOTE_USER@$REMOTE_HOST "/home/$REMOTE_USER/$module/$module.sh"
		ssh -i $SSH_KEY $REMOTE_USER@$REMOTE_HOST "rm -r /home/$REMOTE_USER/$module/"
	fi
fi